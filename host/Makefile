INCLUDE_DIRS:=include 
SOURCE_DIRS:=source
#The name of the final executable
TARGET_NAME:=usb_bulk	
#C Files to compile
CFILES:=Bulk_Application.c
##Installed libraries to be linked
LIBS:=libusb-1.0
#Flags generated by pkg-config on installed libraries
LIB_PKG_FLAGS:=$(shell pkg-config --libs $(LIBS))
#Path to local library 
LIB_DIRS:=
#local libraries to link 
LIB_NAMES:=
#the library file name
LIB_FILE_NAMES:= $(patsubst %,lib%.a,$(LIB_NAMES))
#linker flags 
LFLAGS:= $(patsubst %,-L%,$(LIB_DIRS)) $(patsubst %,-l%,$(LIB_NAMES)) $(LIB_PKG_FLAGS)

DIRS:=objects

INCLUDEFLAGS:=$(patsubst %,-I%,$(INCLUDE_DIRS))
CPPFLAGS:=$(INCLUDEFLAGS) $(shell pkg-config --cflags $(LIBS))
CFLAGS:=-g -Wall -std=c99
CFILENAMES:=$(notdir $(CFILES))
COBJECTS:=$(patsubst %.c,%.o,$(CFILENAMES))
LINK_OBJECTS:=$(patsubst %,objects/%,$(COBJECTS))
CC:=gcc

vpath %.h $(INCLUDE_DIRS)
vpath %.c $(SOURCE_DIRS)
vpath %.o objects
vpath %.a $(LIB_DIRS)

.PHONY: clean

all: $(TARGET_NAME)
$(TARGET_NAME): $(DIRS) $(COBJECTS) $(LIB_FILE_NAMES)
	$(CC) $(CFLAGS) $(LINK_OBJECTS) $(LFLAGS) -o $@
$(COBJECTS): %.o: %.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) $< -o objects/$@

$(DIRS): %:
	mkdir -p $@

clean:
	rm -fr $(DIRS)
	rm -fr $(TARGET_NAME)

#set a udev rules to allow device access without sudo
#RUN THIS TARGET AS SUDO
loadRules:
	echo 'ATTRS{idVendor}=="1cbe", ATTRS{idProduct}=="0003", MODE="664", GROUP="plugdev"' > /etc/udev/rules.d/98-tiva.rules
	sudo udevadm control --reload-rules